<mat-toolbar class="app-header" [class.collapsed]="sidebarCollapsed">
  <!-- Left: Menu toggle -->
  <button mat-icon-button class="menu-toggle  circle-icon-btn" (click)="toggleSidebar()"
    aria-label="Toggle sidebar" type="button">
    <mat-icon>menu</mat-icon>
  </button>

  <!-- Center: breadcrumb / title placeholder -->
  <div class="header-center"></div>

  <!-- Right: icons + user -->
  <div class="header-actions">
    <div class="icon-group">
      <button mat-icon-button class="action-btn circle-icon-btn hide-on-mobile" aria-label="Quick actions"
        type="button">
        <mat-icon>crop_free</mat-icon>
      </button>

      <button mat-icon-button class="action-btn circle-icon-btn notification-btn" [matMenuTriggerFor]="notificationMenu"
        aria-label="Notifications" type="button">
        <mat-icon [matBadge]="notificationCount > 0 ? notificationCount : null" matBadgeColor="warn"
          matBadgeSize="small">
          notifications_none
        </mat-icon>
      </button>
    </div>

    <div class="user-wrapper">
      <button mat-button class="profile-btn" [matMenuTriggerFor]="profileMenu" aria-label="User menu" type="button">
        <div class="profile-content">
          <div class="avatar-circle">
            <img *ngIf="userAvatar; else initialsTemplate" [src]="userAvatar" [alt]="userName" class="avatar-img" />
            <ng-template #initialsTemplate>{{ userInitials }}</ng-template>
          </div>
          <div class="profile-info">
            <span class="profile-name">{{ userName }}</span>
            <div class="profile-meta">
              <span class="profile-role">{{ userRole }}</span>
              <i class="bi bi-chevron-down profile-chevron"></i>
            </div>
          </div>
        </div>
      </button>
    </div>
  </div>
</mat-toolbar>

<!-- ================= NOTIFICATION MENU ================= -->
<mat-menu #notificationMenu="matMenu" xPosition="before" class="notification-menu">
  <div class="menu-header" (click)="$event.stopPropagation()">
    <span class="menu-title">
      <i class="bi bi-bell me-2"></i>
      Notifications
    </span>
    <button mat-button *ngIf="notificationCount > 0" (click)="markAllAsRead(); $event.stopPropagation()"
      class="mark-read-btn" type="button">
      <i class="bi bi-check2-all me-1"></i>
      <span class="mark-read-text">Mark all read</span>
    </button>
  </div>
  <mat-divider></mat-divider>

  <div class="notification-list" (click)="$event.stopPropagation()">
    <div *ngIf="notifications.length === 0" class="empty-state">
      <i class="bi bi-bell-slash"></i>
      <p>No new notifications</p>
    </div>

    <button mat-menu-item *ngFor="let notif of notifications" class="notification-item" [class.unread]="!notif.read"
      (click)="onNotificationClick(notif)" type="button">
      <div class="notif-icon" [ngClass]="notif.type">
        <i class="bi" [ngClass]="getNotificationIcon(notif.type)"></i>
      </div>
      <div class="notif-content">
        <span class="notif-title">{{ notif.title }}</span>
        <span class="notif-description">{{ notif.description }}</span>
        <span class="notif-time">
          <i class="bi bi-clock me-1"></i>
          {{ notif.time }}
        </span>
      </div>

      <span class="notif-dismiss" (click)="dismissNotification(notif, $event)" aria-label="Dismiss notification"
        role="button">
        <i class="bi bi-x"></i>
      </span>
    </button>
  </div>

  <mat-divider *ngIf="notifications.length > 0"></mat-divider>
  <button mat-menu-item class="view-all-btn" *ngIf="notifications.length > 0" (click)="viewAllNotifications()"
    type="button">
    <span>View all</span>
    <i class="bi bi-arrow-right"></i>
  </button>
</mat-menu>

<!-- ================= PROFILE MENU ================= -->
<mat-menu #profileMenu="matMenu" xPosition="before" class="profile-menu">
  <div class="profile-header" (click)="$event.stopPropagation()">
    <div class="avatar-large">
      <img *ngIf="userAvatar; else largeInitialsTemplate" [src]="userAvatar" [alt]="userName" class="avatar-img" />
      <ng-template #largeInitialsTemplate>{{ userInitials }}</ng-template>
    </div>
    <div class="profile-details">
      <span class="name">{{ userName }}</span>
      <span class="email">{{ userEmail }}</span>
    </div>
  </div>

  <mat-divider class="profile-divider"></mat-divider>

  <button mat-menu-item class="profile-item" (click)="goToProfile()" type="button">
    <i class="bi bi-person"></i>
    <span>Profile Details</span>
  </button>

  <button mat-menu-item class="profile-item" (click)="psdChange()" type="button">
    <i class="bi bi-arrow-clockwise"></i>
    <span>Change Password</span>
  </button>

  <mat-divider class="profile-divider"></mat-divider>

  <button mat-menu-item class="profile-item logout-btn" (click)="logout()" type="button">
    <i class="bi bi-box-arrow-right"></i>
    <span>Log Out</span>
  </button>
</mat-menu>