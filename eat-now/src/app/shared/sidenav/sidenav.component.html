<div class="sidenav-wrapper">
  <!-- Mobile hamburger - Only visible on mobile when sidenav is closed -->
  <button class="mobile-hamburger" *ngIf="isMobile && isCollapsed" (click)="toggleSidenav()" aria-label="Open menu">
    <i class="bi bi-list"></i>
  </button>

  <nav class="sidenav" [class.collapsed]="isCollapsed && !isMobile" [class.mobile-open]="!isCollapsed && isMobile"
    [class.mobile-closed]="isCollapsed && isMobile" role="navigation" aria-label="Main navigation">

    <!-- Logo -->
    <div class="logo-section">
      <img src="../../../assets/Images/zeste logo.png" alt="Zeste" class="logo-img" />
      <span class="logo-text" *ngIf="!isCollapsed || isMobile">ZESTE</span>

      <!-- Mobile close button -->
      <button class="mobile-close-btn" *ngIf="isMobile && !isCollapsed" (click)="toggleSidenav()"
        aria-label="Close menu">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>

    <div class="menu-container">
      <!-- GENERAL -->
      <div class="section">
        <span class="section-title" *ngIf="!isCollapsed || isMobile">
          GENERAL
        </span>

        <!-- Dashboard -->
        <div class="menu-item dashboard-item" [class.active]="selectedMenu === 'dashboard'"
          (click)="navigateTo('/core/outlet-onboarding')" role="button" tabindex="0"
          (keydown.enter)="navigateTo('/core/outlet-onboarding')">
          <i class="bi bi-speedometer2"></i>
          <span *ngIf="!isCollapsed || isMobile">Dashboard</span>
        </div>
        <div class="menu-divider"></div>

        <!-- Collapsible Groups -->
        <ng-container *ngFor="let group of collapsibleGroups; trackBy: trackByGroupKey">
          <div class="collapsible-group" [class.has-active]="isGroupActive(group)">
            <!-- Group Header -->
            <div class="group-header" (click)="onGroupHeaderClick($event, group.key)"
              [class.open]="openedGroup === group.key" [class.group-active]="isGroupActive(group)" role="button"
              tabindex="0" [attr.aria-expanded]="openedGroup === group.key"
              (keydown.enter)="onGroupHeaderClick($event, group.key)">
              <div class="header-left">
                <i class="bi" [ngClass]="'bi-' + group.icon"></i>
                <span *ngIf="!isCollapsed || isMobile">
                  {{ group.title }}
                </span>
              </div>
              <i class="bi bi-chevron-down chevron" [class.rotated]="openedGroup === group.key"
                *ngIf="!isCollapsed || isMobile">
              </i>
            </div>

            <!-- FLOATING CARD (Only in collapsed desktop mode) -->
            <div class="floating-card" *ngIf="!isMobile && isCollapsed && openedGroup === group.key"
              [style.top.px]="floatingCardTop" (click)="$event.stopPropagation()" role="menu">
              <div class="floating-card-title">{{ group.title }}</div>
              <ul class="floating-card-menu">
                <li *ngFor="let item of group.items; trackBy: trackByRoute" class="floating-card-item"
                  [class.active]="isRouteActive(item.route)" (click)="navigateTo(item.route, $event)" role="menuitem"
                  tabindex="0" (keydown.enter)="navigateTo(item.route, $event)">
                  {{ item.title }}
                </li>
              </ul>
            </div>

            <!-- Regular submenu (expanded mode or mobile) -->
            <ul class="submenu" *ngIf="!isCollapsed || isMobile" [class.open]="openedGroup === group.key" role="menu">
              <li *ngFor="let item of group.items; trackBy: trackByRoute" class="submenu-item"
                [class.active]="isRouteActive(item.route)" (click)="navigateTo(item.route, $event)" role="menuitem"
                tabindex="0" (keydown.enter)="navigateTo(item.route, $event)">
                <span class="line"></span>
                <span class="label">{{ item.title }}</span>
              </li>
            </ul>
          </div>

          <!-- Divider under each top-level group -->
          <div class="menu-divider"></div>
        </ng-container>
      </div>

      <!-- Announcements -->
      <div class="section misc-section">
        <span class="section-title" *ngIf="!isCollapsed || isMobile">
          Announcements
        </span>

        <div class="menu-item" [class.active]="isRouteActive('/core/announcements')"
          (click)="navigateTo('/core/announcements')" role="button" tabindex="0"
          (keydown.enter)="navigateTo('/core/announcements')">
          <i class="bi bi-megaphone"></i>
          <span *ngIf="!isCollapsed || isMobile">Announcements</span>
        </div>
        <div class="menu-divider"></div>
      </div>

      <!-- MISCELLANEOUS -->
      <div class="section misc-section">
        <span class="section-title" *ngIf="!isCollapsed || isMobile">
          MISCELLANEOUS
        </span>

        <div class="menu-item" [class.active]="isRouteActive('/core/audit-logs')"
          (click)="navigateTo('/core/audit-logs')" role="button" tabindex="0"
          (keydown.enter)="navigateTo('/core/audit-logs')">
          <i class="bi bi-journal-text"></i>
          <span *ngIf="!isCollapsed || isMobile">Audit Logs</span>
        </div>
        <div class="menu-divider"></div>
      </div>
    </div>

    <!-- Collapse Toggle (Desktop only) -->
    <div class="collapse-toggle" (click)="toggleSidenav()" *ngIf="!isMobile" role="button" tabindex="0"
      [attr.aria-label]="isCollapsed ? 'Expand sidebar' : 'Collapse sidebar'" (keydown.enter)="toggleSidenav()">
      <i class="bi" [class.bi-chevron-left]="!isCollapsed" [class.bi-chevron-right]="isCollapsed"></i>
    </div>
  </nav>

  <!-- Overlay - ONLY for mobile -->
  <div class="overlay" *ngIf="isMobile && !isCollapsed" (click)="toggleSidenav()" role="button" aria-label="Close menu">
  </div>
</div>