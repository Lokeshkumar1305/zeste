<div class="sidenav-wrapper">
  <button mat-icon-button class="mobile-hamburger" *ngIf="isMobile && isCollapsed" (click)="toggleSidenav()">
    <i class="bi bi-list"></i>
  </button>
  
  <nav class="sidenav" [class.collapsed]="isCollapsed" [class.mobile-open]="!isCollapsed && isMobile">
    <!-- Logo -->
    <div class="logo-section">
      <img src="../../../assets/Images/zeste logo.png" alt="Zeste" class="logo-img" />
      <span class="logo-text" *ngIf="!isCollapsed">ZESTE</span>
    </div>

    <div class="menu-container">
      <!-- GENERAL -->
      <div class="section">
        <span class="section-title" *ngIf="!isCollapsed">GENERAL</span>

        <!-- Dashboard -->
        <div class="menu-item dashboard-item" 
             [class.active]="selectedMenu === 'dashboard'"
             (click)="navigateTo('/core/outlet-onboarding')">
          <i class="bi bi-speedometer2"></i>
          <span *ngIf="!isCollapsed">Dashboard</span>
        </div>

        <!-- Collapsible Groups -->
        <div class="collapsible-group" *ngFor="let group of collapsibleGroups">
          <!-- Group Header -->
          <div class="group-header" 
               (click)="toggleGroup(group.key)" 
               [class.open]="openedGroup === group.key"
               [class.has-floating-menu]="isCollapsed && openedGroup === group.key">
            <div class="header-left">
              <i class="bi" [class]="'bi-' + group.icon"></i>
              <span *ngIf="!isCollapsed">{{ group.title }}</span>
            </div>
            <i class="bi bi-chevron-down chevron" 
               [class.rotated]="openedGroup === group.key" 
               *ngIf="!isCollapsed"></i>
          </div>

          <!-- Submenu (Inline when expanded, Floating card when collapsed) -->
          <div class="submenu-wrapper" 
               [class.open]="openedGroup === group.key"
               [class.floating]="isCollapsed">
            <ul class="submenu" [class.open]="openedGroup === group.key">
              <li *ngFor="let item of group.items" 
                  class="submenu-item" 
                  [class.active]="isRouteActive(item.route)"
                  (click)="navigateTo(item.route); $event.stopPropagation()">
                <span class="line" *ngIf="!isCollapsed"></span>
                <span class="label">{{ item.title }}</span>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- MISCELLANEOUS -->
      <div class="section misc-section">
        <span class="section-title" *ngIf="!isCollapsed">MISCELLANEOUS</span>
        <div class="menu-item" (click)="navigateTo('/core/audit-logs')">
          <i class="bi bi-journal-text"></i>
          <span *ngIf="!isCollapsed">Audit Logs</span>
        </div>
      </div>
    </div>

    <!-- Collapse Toggle -->
    <div class="collapse-toggle" (click)="toggleSidenav()">
      <i class="bi" [class.bi-chevron-left]="!isCollapsed" [class.bi-chevron-right]="isCollapsed"></i>
    </div>
  </nav>
  
  <!-- Overlay for mobile & for closing floating menu -->
  <div class="overlay" 
       *ngIf="(isMobile && !isCollapsed) || (isCollapsed && openedGroup)" 
       (click)="closeFloatingMenu()"></div>
</div>