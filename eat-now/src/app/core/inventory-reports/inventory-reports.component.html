<div class="inventory-reports-container page-container">
    <div class="inventory-reports-inner">
        <!-- Page Header -->
        <div class="page-header">
            <div class="header-content">
                <h1>
                    <mat-icon>assessment</mat-icon>
                    <span class="header-title-text">Inventory Reports</span>
                </h1>
                <p class="subtitle">Generate and analyze inventory reports</p>
            </div>
            <div class="header-actions">
                <button mat-stroked-button (click)="printReport()" type="button">
                    <mat-icon>print</mat-icon>
                    <span class="btn-text">Print</span>
                </button>
                <button mat-stroked-button (click)="exportToExcel()" type="button">
                    <mat-icon>file_download</mat-icon>
                    <span class="btn-text">Export Excel</span>
                </button>
                <button mat-raised-button color="primary" (click)="exportToPDF()" type="button">
                    <mat-icon>picture_as_pdf</mat-icon>
                    <span class="btn-text">Export PDF</span>
                </button>
            </div>
        </div>

        <!-- Summary Cards -->
        <div class="summary-cards">
            <mat-card class="summary-card">
                <div class="mat-mdc-card-content">
                    <div class="card-icon blue">
                        <mat-icon>inventory_2</mat-icon>
                    </div>
                    <div class="card-content">
                        <div class="value">{{ summaryData.totalItems }}</div>
                        <div class="label">Total Items</div>
                        <div class="summary-hint">Across all categories</div>
                    </div>
                </div>
            </mat-card>

            <mat-card class="summary-card">
                <div class="mat-mdc-card-content">
                    <div class="card-icon green">
                        <mat-icon>account_balance_wallet</mat-icon>
                    </div>
                    <div class="card-content">
                        <div class="value">₹{{ summaryData.totalValue | number }}</div>
                        <div class="label">Total Stock Value</div>
                    </div>
                </div>
            </mat-card>

            <mat-card class="summary-card">
                <div class="mat-mdc-card-content">
                    <div class="card-icon orange">
                        <mat-icon>warning</mat-icon>
                    </div>
                    <div class="card-content">
                        <div class="value warning">{{ summaryData.lowStockItems }}</div>
                        <div class="label">Low Stock Items</div>
                    </div>
                </div>
            </mat-card>

            <mat-card class="summary-card">
                <div class="mat-mdc-card-content">
                    <div class="card-icon red">
                        <mat-icon>remove_circle</mat-icon>
                    </div>
                    <div class="card-content">
                        <div class="value danger">{{ summaryData.outOfStockItems }}</div>
                        <div class="label">Out of Stock</div>
                    </div>
                </div>
            </mat-card>
        </div>

        <!-- Report Type Selection -->
        <mat-card class="report-type-card">
            <mat-card-content>
                <div class="report-type-buttons">
                    <button *ngFor="let type of reportTypes" mat-stroked-button type="button"
                        [class.active]="selectedReportType === type.value" (click)="onReportTypeChange(type.value)">
                        <mat-icon>{{ type.icon }}</mat-icon>
                        <span class="report-type-label">{{ type.label }}</span>
                    </button>
                </div>
            </mat-card-content>
        </mat-card>

        <!-- Filters Section -->
        <mat-card class="filter-card">
            <mat-card-header>
                <mat-card-title>
                    <mat-icon>filter_list</mat-icon>
                    <span class="filter-title-text">Filter Options</span>
                </mat-card-title>
            </mat-card-header>
            <mat-card-content>
                <form [formGroup]="filterForm" class="filter-form">
                    <mat-form-field appearance="outline">
                        <mat-label>Date From</mat-label>
                        <input matInput [matDatepicker]="dateFromPicker" formControlName="dateFrom" />
                        <mat-datepicker-toggle matSuffix [for]="dateFromPicker"></mat-datepicker-toggle>
                        <mat-datepicker #dateFromPicker></mat-datepicker>
                    </mat-form-field>

                    <mat-form-field appearance="outline">
                        <mat-label>Date To</mat-label>
                        <input matInput [matDatepicker]="dateToPicker" formControlName="dateTo" />
                        <mat-datepicker-toggle matSuffix [for]="dateToPicker"></mat-datepicker-toggle>
                        <mat-datepicker #dateToPicker></mat-datepicker>
                    </mat-form-field>

                    <mat-form-field appearance="outline">
                        <mat-label>Category</mat-label>
                        <mat-select formControlName="categoryId">
                            <mat-option [value]="null">All Categories</mat-option>
                            <mat-option *ngFor="let category of categories" [value]="category.id">
                                {{ category.name }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>

                    <mat-form-field appearance="outline" *ngIf="
              selectedReportType === 'purchase' ||
              selectedReportType === 'supplier'
            ">
                        <mat-label>Supplier</mat-label>
                        <mat-select formControlName="supplierId">
                            <mat-option [value]="null">All Suppliers</mat-option>
                            <mat-option *ngFor="let supplier of suppliers" [value]="supplier.id">
                                {{ supplier.name }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>

                    <mat-form-field appearance="outline" *ngIf="
              selectedReportType === 'stock' ||
              selectedReportType === 'movement'
            ">
                        <mat-label>Status</mat-label>
                        <mat-select formControlName="status">
                            <mat-option *ngFor="let status of statusOptions" [value]="status.value">
                                {{ status.label }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>

                    <div class="filter-actions">
                        <button mat-raised-button color="primary" type="button" (click)="applyFilter()">
                            <mat-icon>search</mat-icon>
                            <span class="btn-text">Apply</span>
                        </button>
                        <button mat-stroked-button type="button" (click)="resetFilters()">
                            <mat-icon>refresh</mat-icon>
                            <span class="btn-text">Reset</span>
                        </button>
                    </div>
                </form>
            </mat-card-content>
        </mat-card>

        <!-- Loading Spinner -->
        <div class="loading-container" *ngIf="isLoading">
            <mat-spinner diameter="50"></mat-spinner>
            <p>Loading report data...</p>
        </div>

        <!-- =========================
         STOCK REPORT
         ========================= -->
        <mat-card class="report-table-card" *ngIf="
        (selectedReportType === 'stock' ||
          selectedReportType === 'lowstock') &&
        !isLoading
      ">
            <mat-card-header>
                <mat-card-title>
                    <mat-icon>inventory_2</mat-icon>
                    <span class="card-title-text">
                        {{
                        selectedReportType === 'lowstock'
                        ? 'Low Stock Alert Report'
                        : 'Stock Report'
                        }}
                    </span>
                </mat-card-title>
                <mat-form-field appearance="outline" class="search-field">
                    <mat-label>Search</mat-label>
                    <input matInput (keyup)="applyTableFilter($event, stockDataSource)" placeholder="Search items..." />
                    <mat-icon matSuffix>search</mat-icon>
                </mat-form-field>
            </mat-card-header>
            <mat-card-content>
                <!-- Desktop Table -->
                <div class="table-container desktop-table">
                    <table mat-table [dataSource]="stockDataSource" matSort class="report-table">
                        <ng-container matColumnDef="itemName">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Item Name
                            </th>
                            <td mat-cell *matCellDef="let row">
                                <span class="text-truncate-cell" [title]="row.itemName">{{ row.itemName }}</span>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="categoryName">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Category
                            </th>
                            <td mat-cell *matCellDef="let row">
                                <span class="text-truncate-cell" [title]="row.categoryName">{{ row.categoryName
                                    }}</span>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="currentStock">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Current Stock
                            </th>
                            <td mat-cell *matCellDef="let row">
                                <span class="stock-value">{{ row.currentStock }}
                                    <span class="unit-text">
                                        {{ row.unitName }}
                                    </span></span>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="minStock">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Min Stock
                            </th>
                            <td mat-cell *matCellDef="let row">
                                {{ row.minStock }}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="reorderLevel">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Reorder
                            </th>
                            <td mat-cell *matCellDef="let row">
                                {{ row.reorderLevel }}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="stockValue">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Stock Value
                            </th>
                            <td mat-cell *matCellDef="let row">
                                ₹{{ row.stockValue | number }}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="status">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Status
                            </th>
                            <td mat-cell *matCellDef="let row">
                                <span class="status-badge" [ngClass]="getStatusClass(row.status)">
                                    <span class="status-text">{{ row.status }}</span>
                                </span>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="lastUpdated">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Updated
                            </th>
                            <td mat-cell *matCellDef="let row">
                                {{ row.lastUpdated | date: 'dd/MM/yy' }}
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="stockColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: stockColumns"></tr>

                        <tr class="no-data-row" *matNoDataRow>
                            <td [attr.colspan]="stockColumns.length" class="no-data">
                                <mat-icon>inbox</mat-icon>
                                <p>No stock data available</p>
                            </td>
                        </tr>
                    </table>
                </div>

                <!-- Mobile Cards -->
                <div class="mobile-cards" *ngIf="stockDataSource">
                    <div class="mobile-card" *ngFor="
              let row of (stockDataSource?.filteredData || [])
            ">
                        <div class="mobile-card-header">
                            <div>
                                <div class="mobile-card-title">
                                    {{ row.itemName }}
                                </div>
                                <div class="mobile-card-subtitle">
                                    {{ row.categoryName }}
                                </div>
                            </div>
                            <span class="status-badge" [ngClass]="getStatusClass(row.status)">
                                {{ row.status }}
                            </span>
                        </div>
                        <div class="mobile-card-body">
                            <div class="mobile-field">
                                <span class="field-label">Current Stock</span>
                                <span class="field-value">
                                    {{ row.currentStock }} {{ row.unitName }}
                                </span>
                            </div>
                            <div class="mobile-field">
                                <span class="field-label">Min / Reorder</span>
                                <span class="field-value">
                                    {{ row.minStock }} / {{ row.reorderLevel }}
                                </span>
                            </div>
                            <div class="mobile-field">
                                <span class="field-label">Stock Value</span>
                                <span class="field-value">
                                    ₹{{ row.stockValue | number }}
                                </span>
                            </div>
                            <div class="mobile-field">
                                <span class="field-label">Last Updated</span>
                                <span class="field-value">
                                    {{ row.lastUpdated | date: 'dd/MM/yyyy' }}
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="no-data no-data-card" *ngIf="
              (stockDataSource?.filteredData?.length || 0) === 0
            ">
                        <mat-icon>inbox</mat-icon>
                        <p>No stock data available</p>
                    </div>
                </div>

                <div class="report-pagination-bar">
                    <mat-paginator #stockPaginator [pageSizeOptions]="[10, 25, 50, 100]"
                        style="display: none;"></mat-paginator>
                    <div class="custom-pagination-container">
                        <div class="pagination-info">
                            <span class="range-label">{{ getCustomRangeLabel(stockPaginator) }}</span>
                            <span class="rows-per-page-label">Rows per page:</span>
                            <div class="custom-select-wrapper">
                                <select [value]="stockPaginator?.pageSize"
                                    (change)="onCustomPageSizeChange(stockPaginator, $any($event.target).value)"
                                    class="custom-page-select">
                                    <option *ngFor="let size of [10, 25, 50, 100]" [value]="size">{{ size }}</option>
                                </select>
                            </div>
                        </div>
                        <div class="pagination-actions">
                            <button class="paginator-btn prev-btn" [disabled]="!hasPreviousPage(stockPaginator)"
                                (click)="goToPreviousPage(stockPaginator)">
                                <i class="bi bi-chevron-left"></i> Previous
                            </button>
                            <div class="page-numbers-container">
                                <button *ngFor="let page of getPageNumbers(stockPaginator)" class="page-number-btn"
                                    [class.active]="page === stockPaginator?.pageIndex"
                                    (click)="goToPage(stockPaginator, page)">
                                    {{ page + 1 }}
                                </button>
                            </div>
                            <button class="paginator-btn next-btn" [disabled]="!hasNextPage(stockPaginator)"
                                (click)="goToNextPage(stockPaginator)">
                                Next <i class="bi bi-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>


            </mat-card-content>
        </mat-card>

        <!-- MOVEMENT REPORT -->
        <mat-card class="report-table-card" *ngIf="selectedReportType === 'movement' && !isLoading">
            <mat-card-header>
                <mat-card-title>
                    <mat-icon>swap_horiz</mat-icon>
                    <span class="card-title-text">Movement Report</span>
                </mat-card-title>
                <mat-form-field appearance="outline" class="search-field">
                    <mat-label>Search</mat-label>
                    <input matInput (keyup)="applyTableFilter($event, movementDataSource)" placeholder="Search..." />
                    <mat-icon matSuffix>search</mat-icon>
                </mat-form-field>
            </mat-card-header>
            <mat-card-content>
                <div class="table-container desktop-table">
                    <table mat-table [dataSource]="movementDataSource" matSort class="report-table">
                        <ng-container matColumnDef="movementDate">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Date
                            </th>
                            <td mat-cell *matCellDef="let row">
                                {{ row.movementDate | date: 'dd/MM/yy' }}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="itemName">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Item
                            </th>
                            <td mat-cell *matCellDef="let row">
                                <span class="text-truncate-cell" [title]="row.itemName">{{ row.itemName }}</span>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="movementType">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Type
                            </th>
                            <td mat-cell *matCellDef="let row">
                                <span class="movement-type-badge" [ngClass]="getMovementTypeClass(row.movementType)">
                                    <mat-icon *ngIf="row.movementType === 'IN'">
                                        arrow_downward
                                    </mat-icon>
                                    <mat-icon *ngIf="row.movementType === 'OUT'">
                                        arrow_upward
                                    </mat-icon>
                                    <mat-icon *ngIf="row.movementType === 'TRANSFER'">
                                        swap_horiz
                                    </mat-icon>
                                    <mat-icon *ngIf="row.movementType === 'ADJUSTMENT'">
                                        tune
                                    </mat-icon>
                                    <span class="type-text">
                                        {{ row.movementType }}
                                    </span>
                                </span>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="quantity">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Qty
                            </th>
                            <td mat-cell *matCellDef="let row">
                                <span [class.positive]="row.quantity > 0" [class.negative]="row.quantity < 0">{{
                                    row.quantity > 0 ? '+' : '' }}{{
                                    row.quantity
                                    }}</span>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="fromLocation">
                            <th mat-header-cell *matHeaderCellDef>From</th>
                            <td mat-cell *matCellDef="let row">
                                <span class="text-truncate-cell">
                                    {{ row.fromLocation || '-' }}
                                </span>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="toLocation">
                            <th mat-header-cell *matHeaderCellDef>To</th>
                            <td mat-cell *matCellDef="let row">
                                <span class="text-truncate-cell">
                                    {{ row.toLocation || '-' }}
                                </span>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="performedBy">
                            <th mat-header-cell *matHeaderCellDef>By</th>
                            <td mat-cell *matCellDef="let row">
                                <span class="text-truncate-cell">
                                    {{ row.performedBy || '-' }}
                                </span>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="remarks">
                            <th mat-header-cell *matHeaderCellDef>Remarks</th>
                            <td mat-cell *matCellDef="let row">
                                <span class="text-truncate-cell" [title]="row.remarks">{{ row.remarks || '-' }}</span>
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="movementColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: movementColumns"></tr>

                        <tr class="no-data-row" *matNoDataRow>
                            <td [attr.colspan]="movementColumns.length" class="no-data">
                                <mat-icon>inbox</mat-icon>
                                <p>No movement data available</p>
                            </td>
                        </tr>
                    </table>
                </div>

                <!-- Mobile Cards for Movement -->
                <div class="mobile-cards" *ngIf="movementDataSource">
                    <div class="mobile-card" *ngFor="
              let row of (movementDataSource?.filteredData || [])
            ">
                        <div class="mobile-card-header">
                            <div>
                                <div class="mobile-card-title">
                                    {{ row.itemName }}
                                </div>
                                <div class="mobile-card-subtitle">
                                    {{
                                    row.movementDate
                                    | date: 'dd/MM/yyyy HH:mm'
                                    }}
                                </div>
                            </div>
                            <span class="movement-type-badge" [ngClass]="getMovementTypeClass(row.movementType)">
                                <mat-icon *ngIf="row.movementType === 'IN'">
                                    arrow_downward
                                </mat-icon>
                                <mat-icon *ngIf="row.movementType === 'OUT'">
                                    arrow_upward
                                </mat-icon>
                                <mat-icon *ngIf="row.movementType === 'TRANSFER'">
                                    swap_horiz
                                </mat-icon>
                                <mat-icon *ngIf="row.movementType === 'ADJUSTMENT'">
                                    tune
                                </mat-icon>
                                {{ row.movementType }}
                            </span>
                        </div>
                        <div class="mobile-card-body">
                            <div class="mobile-field">
                                <span class="field-label">Quantity</span>
                                <span class="field-value" [class.positive]="row.quantity > 0"
                                    [class.negative]="row.quantity < 0">{{ row.quantity > 0 ? '+' : '' }}{{
                                    row.quantity
                                    }}</span>
                            </div>
                            <div class="mobile-field">
                                <span class="field-label">From / To</span>
                                <span class="field-value">
                                    {{ row.fromLocation || '-' }} → {{
                                    row.toLocation || '-'
                                    }}
                                </span>
                            </div>
                            <div class="mobile-field">
                                <span class="field-label">By</span>
                                <span class="field-value">
                                    {{ row.performedBy || '-' }}
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="no-data no-data-card" *ngIf="
              (movementDataSource?.filteredData?.length || 0) === 0
            ">
                        <mat-icon>inbox</mat-icon>
                        <p>No movement data available</p>
                    </div>
                </div>

                <div class="report-pagination-bar">
                    <mat-paginator #movementPaginator [pageSizeOptions]="[10, 25, 50, 100]"
                        style="display: none;"></mat-paginator>
                    <div class="custom-pagination-container">
                        <div class="pagination-info">
                            <span class="range-label">{{ getCustomRangeLabel(movementPaginator) }}</span>
                            <span class="rows-per-page-label">Rows per page:</span>
                            <div class="custom-select-wrapper">
                                <select [value]="movementPaginator?.pageSize"
                                    (change)="onCustomPageSizeChange(movementPaginator, $any($event.target).value)"
                                    class="custom-page-select">
                                    <option *ngFor="let size of [10, 25, 50, 100]" [value]="size">{{ size }}</option>
                                </select>
                            </div>
                        </div>
                        <div class="pagination-actions">
                            <button class="paginator-btn prev-btn" [disabled]="!hasPreviousPage(movementPaginator)"
                                (click)="goToPreviousPage(movementPaginator)">
                                <i class="bi bi-chevron-left"></i> Previous
                            </button>
                            <div class="page-numbers-container">
                                <button *ngFor="let page of getPageNumbers(movementPaginator)" class="page-number-btn"
                                    [class.active]="page === movementPaginator?.pageIndex"
                                    (click)="goToPage(movementPaginator, page)">
                                    {{ page + 1 }}
                                </button>
                            </div>
                            <button class="paginator-btn next-btn" [disabled]="!hasNextPage(movementPaginator)"
                                (click)="goToNextPage(movementPaginator)">
                                Next <i class="bi bi-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>


            </mat-card-content>
        </mat-card>

        <!-- PURCHASE REPORT -->
        <mat-card class="report-table-card" *ngIf="selectedReportType === 'purchase' && !isLoading">
            <mat-card-header>
                <mat-card-title>
                    <mat-icon>shopping_cart</mat-icon>
                    <span class="card-title-text">Purchase Order Report</span>
                </mat-card-title>
                <mat-form-field appearance="outline" class="search-field">
                    <mat-label>Search</mat-label>
                    <input matInput (keyup)="applyTableFilter($event, purchaseDataSource)" placeholder="Search..." />
                    <mat-icon matSuffix>search</mat-icon>
                </mat-form-field>
            </mat-card-header>
            <mat-card-content>
                <div class="table-container desktop-table">
                    <table mat-table [dataSource]="purchaseDataSource" matSort class="report-table">
                        <ng-container matColumnDef="orderNo">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Order No
                            </th>
                            <td mat-cell *matCellDef="let row">
                                <span class="order-number">{{ row.orderNo }}</span>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="supplierName">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Supplier
                            </th>
                            <td mat-cell *matCellDef="let row">
                                <span class="text-truncate-cell" [title]="row.supplierName">{{ row.supplierName
                                    }}</span>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="orderDate">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Order Date
                            </th>
                            <td mat-cell *matCellDef="let row">
                                {{ row.orderDate | date: 'dd/MM/yy' }}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="expectedDelivery">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Expected
                            </th>
                            <td mat-cell *matCellDef="let row">
                                {{ row.expectedDelivery | date: 'dd/MM/yy' }}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="totalItems">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Items
                            </th>
                            <td mat-cell *matCellDef="let row">
                                {{ row.totalItems }}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="totalAmount">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Amount
                            </th>
                            <td mat-cell *matCellDef="let row">
                                ₹{{ row.totalAmount | number }}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="status">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Status
                            </th>
                            <td mat-cell *matCellDef="let row">
                                <span class="status-badge" [ngClass]="getStatusClass(row.status)">
                                    <span class="status-text">{{ row.status }}</span>
                                </span>
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="purchaseColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: purchaseColumns"></tr>

                        <tr class="no-data-row" *matNoDataRow>
                            <td [attr.colspan]="purchaseColumns.length" class="no-data">
                                <mat-icon>inbox</mat-icon>
                                <p>No purchase order data available</p>
                            </td>
                        </tr>
                    </table>
                </div>

                <!-- Mobile Cards for Purchase -->
                <div class="mobile-cards" *ngIf="purchaseDataSource">
                    <div class="mobile-card" *ngFor="
              let row of (purchaseDataSource?.filteredData || [])
            ">
                        <div class="mobile-card-header">
                            <div>
                                <div class="mobile-card-title">
                                    Order #{{ row.orderNo }}
                                </div>
                                <div class="mobile-card-subtitle">
                                    {{ row.supplierName }}
                                </div>
                            </div>
                            <span class="status-badge" [ngClass]="getStatusClass(row.status)">
                                {{ row.status }}
                            </span>
                        </div>
                        <div class="mobile-card-body">
                            <div class="mobile-field">
                                <span class="field-label">Order Date</span>
                                <span class="field-value">
                                    {{ row.orderDate | date: 'dd/MM/yyyy' }}
                                </span>
                            </div>
                            <div class="mobile-field">
                                <span class="field-label">Expected</span>
                                <span class="field-value">
                                    {{ row.expectedDelivery | date: 'dd/MM/yyyy' }}
                                </span>
                            </div>
                            <div class="mobile-field">
                                <span class="field-label">Items</span>
                                <span class="field-value">
                                    {{ row.totalItems }}
                                </span>
                            </div>
                            <div class="mobile-field">
                                <span class="field-label">Amount</span>
                                <span class="field-value">
                                    ₹{{ row.totalAmount | number }}
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="no-data no-data-card" *ngIf="
              (purchaseDataSource?.filteredData?.length || 0) === 0
            ">
                        <mat-icon>inbox</mat-icon>
                        <p>No purchase order data available</p>
                    </div>
                </div>

                <div class="report-pagination-bar">
                    <mat-paginator #purchasePaginator [pageSizeOptions]="[10, 25, 50, 100]"
                        style="display: none;"></mat-paginator>
                    <div class="custom-pagination-container">
                        <div class="pagination-info">
                            <span class="range-label">{{ getCustomRangeLabel(purchasePaginator) }}</span>
                            <span class="rows-per-page-label">Rows per page:</span>
                            <div class="custom-select-wrapper">
                                <select [value]="purchasePaginator?.pageSize"
                                    (change)="onCustomPageSizeChange(purchasePaginator, $any($event.target).value)"
                                    class="custom-page-select">
                                    <option *ngFor="let size of [10, 25, 50, 100]" [value]="size">{{ size }}</option>
                                </select>
                            </div>
                        </div>
                        <div class="pagination-actions">
                            <button class="paginator-btn prev-btn" [disabled]="!hasPreviousPage(purchasePaginator)"
                                (click)="goToPreviousPage(purchasePaginator)">
                                <i class="bi bi-chevron-left"></i> Previous
                            </button>
                            <div class="page-numbers-container">
                                <button *ngFor="let page of getPageNumbers(purchasePaginator)" class="page-number-btn"
                                    [class.active]="page === purchasePaginator?.pageIndex"
                                    (click)="goToPage(purchasePaginator, page)">
                                    {{ page + 1 }}
                                </button>
                            </div>
                            <button class="paginator-btn next-btn" [disabled]="!hasNextPage(purchasePaginator)"
                                (click)="goToNextPage(purchasePaginator)">
                                Next <i class="bi bi-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>


            </mat-card-content>
        </mat-card>

        <!-- CATEGORY REPORT -->
        <mat-card class="report-table-card" *ngIf="selectedReportType === 'category' && !isLoading">
            <mat-card-header>
                <mat-card-title>
                    <mat-icon>category</mat-icon>
                    <span class="card-title-text">Category Wise Report</span>
                </mat-card-title>
                <mat-form-field appearance="outline" class="search-field">
                    <mat-label>Search</mat-label>
                    <input matInput (keyup)="applyTableFilter($event, categoryDataSource)" placeholder="Search..." />
                    <mat-icon matSuffix>search</mat-icon>
                </mat-form-field>
            </mat-card-header>
            <mat-card-content>
                <div class="table-container desktop-table">
                    <table mat-table [dataSource]="categoryDataSource" matSort class="report-table">
                        <ng-container matColumnDef="categoryName">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Category
                            </th>
                            <td mat-cell *matCellDef="let row">
                                <span class="category-name text-truncate-cell" [title]="row.categoryName">{{
                                    row.categoryName }}</span>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="totalItems">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Items
                            </th>
                            <td mat-cell *matCellDef="let row">
                                {{ row.totalItems }}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="totalQuantity">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Total Qty
                            </th>
                            <td mat-cell *matCellDef="let row">
                                {{ row.totalQuantity | number }}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="totalValue">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Total Value
                            </th>
                            <td mat-cell *matCellDef="let row">
                                ₹{{ row.totalValue | number }}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="lowStockItems">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Low Stock
                            </th>
                            <td mat-cell *matCellDef="let row">
                                <span [class.warning]="row.lowStockItems > 0">{{ row.lowStockItems }}</span>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="outOfStockItems">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Out of Stock
                            </th>
                            <td mat-cell *matCellDef="let row">
                                <span [class.danger]="row.outOfStockItems > 0">{{ row.outOfStockItems }}</span>
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="categoryColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: categoryColumns"></tr>

                        <tr class="no-data-row" *matNoDataRow>
                            <td [attr.colspan]="categoryColumns.length" class="no-data">
                                <mat-icon>inbox</mat-icon>
                                <p>No category data available</p>
                            </td>
                        </tr>
                    </table>
                </div>

                <!-- Mobile Cards for Category -->
                <div class="mobile-cards" *ngIf="categoryDataSource">
                    <div class="mobile-card" *ngFor="
              let row of (categoryDataSource?.filteredData || [])
            ">
                        <div class="mobile-card-header">
                            <div class="mobile-card-title">
                                {{ row.categoryName }}
                            </div>
                        </div>
                        <div class="mobile-card-body">
                            <div class="mobile-field">
                                <span class="field-label">Total Items</span>
                                <span class="field-value">
                                    {{ row.totalItems }}
                                </span>
                            </div>
                            <div class="mobile-field">
                                <span class="field-label">Total Quantity</span>
                                <span class="field-value">
                                    {{ row.totalQuantity | number }}
                                </span>
                            </div>
                            <div class="mobile-field">
                                <span class="field-label">Total Value</span>
                                <span class="field-value">
                                    ₹{{ row.totalValue | number }}
                                </span>
                            </div>
                            <div class="mobile-field">
                                <span class="field-label">Low / Out of Stock</span>
                                <span class="field-value">
                                    {{ row.lowStockItems }} /
                                    {{ row.outOfStockItems }}
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="no-data no-data-card" *ngIf="
              (categoryDataSource?.filteredData?.length || 0) === 0
            ">
                        <mat-icon>inbox</mat-icon>
                        <p>No category data available</p>
                    </div>
                </div>

                <div class="report-pagination-bar">
                    <mat-paginator #categoryPaginator [pageSizeOptions]="[10, 25, 50, 100]"
                        style="display: none;"></mat-paginator>
                    <div class="custom-pagination-container">
                        <div class="pagination-info">
                            <span class="range-label">{{ getCustomRangeLabel(categoryPaginator) }}</span>
                            <span class="rows-per-page-label">Rows per page:</span>
                            <div class="custom-select-wrapper">
                                <select [value]="categoryPaginator?.pageSize"
                                    (change)="onCustomPageSizeChange(categoryPaginator, $any($event.target).value)"
                                    class="custom-page-select">
                                    <option *ngFor="let size of [10, 25, 50, 100]" [value]="size">{{ size }}</option>
                                </select>
                            </div>
                        </div>
                        <div class="pagination-actions">
                            <button class="paginator-btn prev-btn" [disabled]="!hasPreviousPage(categoryPaginator)"
                                (click)="goToPreviousPage(categoryPaginator)">
                                <i class="bi bi-chevron-left"></i> Previous
                            </button>
                            <div class="page-numbers-container">
                                <button *ngFor="let page of getPageNumbers(categoryPaginator)" class="page-number-btn"
                                    [class.active]="page === categoryPaginator?.pageIndex"
                                    (click)="goToPage(categoryPaginator, page)">
                                    {{ page + 1 }}
                                </button>
                            </div>
                            <button class="paginator-btn next-btn" [disabled]="!hasNextPage(categoryPaginator)"
                                (click)="goToNextPage(categoryPaginator)">
                                Next <i class="bi bi-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>


            </mat-card-content>
        </mat-card>

        <!-- SUPPLIER REPORT -->
        <mat-card class="report-table-card" *ngIf="selectedReportType === 'supplier' && !isLoading">
            <mat-card-header>
                <mat-card-title>
                    <mat-icon>local_shipping</mat-icon>
                    <span class="card-title-text">Supplier Report</span>
                </mat-card-title>
                <mat-form-field appearance="outline" class="search-field">
                    <mat-label>Search</mat-label>
                    <input matInput (keyup)="applyTableFilter($event, supplierDataSource)" placeholder="Search..." />
                    <mat-icon matSuffix>search</mat-icon>
                </mat-form-field>
            </mat-card-header>
            <mat-card-content>
                <div class="table-container desktop-table">
                    <table mat-table [dataSource]="supplierDataSource" matSort class="report-table">
                        <ng-container matColumnDef="supplierName">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Supplier
                            </th>
                            <td mat-cell *matCellDef="let row">
                                <span class="text-truncate-cell" [title]="row.supplierName">{{ row.supplierName
                                    }}</span>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="totalOrders">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Orders
                            </th>
                            <td mat-cell *matCellDef="let row">
                                {{ row.totalOrders }}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="totalAmount">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Amount
                            </th>
                            <td mat-cell *matCellDef="let row">
                                ₹{{ row.totalAmount | number }}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="pendingOrders">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Pending
                            </th>
                            <td mat-cell *matCellDef="let row">
                                <span [class.warning]="row.pendingOrders > 0">{{ row.pendingOrders }}</span>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="completedOrders">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Completed
                            </th>
                            <td mat-cell *matCellDef="let row">
                                {{ row.completedOrders }}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="avgDeliveryDays">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Avg Days
                            </th>
                            <td mat-cell *matCellDef="let row">
                                {{ row.avgDeliveryDays }}d
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="lastOrderDate">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Last Order
                            </th>
                            <td mat-cell *matCellDef="let row">
                                {{ row.lastOrderDate | date: 'dd/MM/yy' }}
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="supplierColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: supplierColumns"></tr>

                        <tr class="no-data-row" *matNoDataRow>
                            <td [attr.colspan]="supplierColumns.length" class="no-data">
                                <mat-icon>inbox</mat-icon>
                                <p>No supplier data available</p>
                            </td>
                        </tr>
                    </table>
                </div>

                <!-- Mobile Cards for Supplier -->
                <div class="mobile-cards" *ngIf="supplierDataSource">
                    <div class="mobile-card" *ngFor="
              let row of (supplierDataSource?.filteredData || [])
            ">
                        <div class="mobile-card-header">
                            <div class="mobile-card-title">
                                {{ row.supplierName }}
                            </div>
                        </div>
                        <div class="mobile-card-body">
                            <div class="mobile-field">
                                <span class="field-label">Total Orders</span>
                                <span class="field-value">
                                    {{ row.totalOrders }}
                                </span>
                            </div>
                            <div class="mobile-field">
                                <span class="field-label">Total Amount</span>
                                <span class="field-value">
                                    ₹{{ row.totalAmount | number }}
                                </span>
                            </div>
                            <div class="mobile-field">
                                <span class="field-label">Pending / Completed</span>
                                <span class="field-value">
                                    {{ row.pendingOrders }} /
                                    {{ row.completedOrders }}
                                </span>
                            </div>
                            <div class="mobile-field">
                                <span class="field-label">Avg. Delivery</span>
                                <span class="field-value">
                                    {{ row.avgDeliveryDays }} days
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="no-data no-data-card" *ngIf="
              (supplierDataSource?.filteredData?.length || 0) === 0
            ">
                        <mat-icon>inbox</mat-icon>
                        <p>No supplier data available</p>
                    </div>
                </div>

                <div class="report-pagination-bar">
                    <mat-paginator #supplierPaginator [pageSizeOptions]="[10, 25, 50, 100]"
                        style="display: none;"></mat-paginator>
                    <div class="custom-pagination-container">
                        <div class="pagination-info">
                            <span class="range-label">{{ getCustomRangeLabel(supplierPaginator) }}</span>
                            <span class="rows-per-page-label">Rows per page:</span>
                            <div class="custom-select-wrapper">
                                <select [value]="supplierPaginator?.pageSize"
                                    (change)="onCustomPageSizeChange(supplierPaginator, $any($event.target).value)"
                                    class="custom-page-select">
                                    <option *ngFor="let size of [10, 25, 50, 100]" [value]="size">{{ size }}</option>
                                </select>
                            </div>
                        </div>
                        <div class="pagination-actions">
                            <button class="paginator-btn prev-btn" [disabled]="!hasPreviousPage(supplierPaginator)"
                                (click)="goToPreviousPage(supplierPaginator)">
                                <i class="bi bi-chevron-left"></i> Previous
                            </button>
                            <div class="page-numbers-container">
                                <button *ngFor="let page of getPageNumbers(supplierPaginator)" class="page-number-btn"
                                    [class.active]="page === supplierPaginator?.pageIndex"
                                    (click)="goToPage(supplierPaginator, page)">
                                    {{ page + 1 }}
                                </button>
                            </div>
                            <button class="paginator-btn next-btn" [disabled]="!hasNextPage(supplierPaginator)"
                                (click)="goToNextPage(supplierPaginator)">
                                Next <i class="bi bi-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>


            </mat-card-content>
        </mat-card>

        <!-- CONSUMPTION REPORT -->
        <mat-card class="report-table-card" *ngIf="selectedReportType === 'consumption' && !isLoading">
            <mat-card-header>
                <mat-card-title>
                    <mat-icon>trending_down</mat-icon>
                    <span class="card-title-text">Consumption Report</span>
                </mat-card-title>
                <mat-form-field appearance="outline" class="search-field">
                    <mat-label>Search</mat-label>
                    <input matInput (keyup)="applyTableFilter($event, consumptionDataSource)" placeholder="Search..." />
                    <mat-icon matSuffix>search</mat-icon>
                </mat-form-field>
            </mat-card-header>
            <mat-card-content>
                <div class="table-container desktop-table">
                    <table mat-table [dataSource]="consumptionDataSource" matSort class="report-table">
                        <ng-container matColumnDef="itemName">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Item
                            </th>
                            <td mat-cell *matCellDef="let row">
                                <span class="text-truncate-cell" [title]="row.itemName">{{ row.itemName }}</span>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="categoryName">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Category
                            </th>
                            <td mat-cell *matCellDef="let row">
                                <span class="text-truncate-cell">
                                    {{ row.categoryName }}
                                </span>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="openingStock">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Opening
                            </th>
                            <td mat-cell *matCellDef="let row">
                                {{ row.openingStock }}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="received">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Received
                            </th>
                            <td mat-cell *matCellDef="let row" class="positive">
                                +{{ row.received }}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="consumed">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Consumed
                            </th>
                            <td mat-cell *matCellDef="let row" class="negative">
                                -{{ row.consumed }}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="closingStock">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Closing
                            </th>
                            <td mat-cell *matCellDef="let row">
                                <strong>{{ row.closingStock }}</strong>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="avgDailyConsumption">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Avg Daily
                            </th>
                            <td mat-cell *matCellDef="let row">
                                {{ row.avgDailyConsumption }}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="daysRemaining">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                Days Left
                            </th>
                            <td mat-cell *matCellDef="let row">
                                <span [class.danger]="row.daysRemaining <= 7" [class.warning]="
                    row.daysRemaining > 7 &&
                    row.daysRemaining <= 14
                  ">{{ row.daysRemaining }}d</span>
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="consumptionColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: consumptionColumns"></tr>

                        <tr class="no-data-row" *matNoDataRow>
                            <td [attr.colspan]="consumptionColumns.length" class="no-data">
                                <mat-icon>inbox</mat-icon>
                                <p>No consumption data available</p>
                            </td>
                        </tr>
                    </table>
                </div>

                <!-- Mobile Cards for Consumption -->
                <div class="mobile-cards" *ngIf="consumptionDataSource">
                    <div class="mobile-card" *ngFor="
              let row of (consumptionDataSource?.filteredData || [])
            ">
                        <div class="mobile-card-header">
                            <div>
                                <div class="mobile-card-title">
                                    {{ row.itemName }}
                                </div>
                                <div class="mobile-card-subtitle">
                                    {{ row.categoryName }}
                                </div>
                            </div>
                        </div>
                        <div class="mobile-card-body">
                            <div class="mobile-field">
                                <span class="field-label">Opening / Closing</span>
                                <span class="field-value">
                                    {{ row.openingStock }} /
                                    {{ row.closingStock }}
                                </span>
                            </div>
                            <div class="mobile-field">
                                <span class="field-label">Received</span>
                                <span class="field-value positive">
                                    +{{ row.received }}
                                </span>
                            </div>
                            <div class="mobile-field">
                                <span class="field-label">Consumed</span>
                                <span class="field-value negative">
                                    -{{ row.consumed }}
                                </span>
                            </div>
                            <div class="mobile-field">
                                <span class="field-label">Days Remaining</span>
                                <span class="field-value" [class.danger]="row.daysRemaining <= 7" [class.warning]="
                    row.daysRemaining > 7 &&
                    row.daysRemaining <= 14
                  ">{{ row.daysRemaining }} days</span>
                            </div>
                        </div>
                    </div>

                    <div class="no-data no-data-card" *ngIf="
              (consumptionDataSource?.filteredData?.length || 0) ===
              0
            ">
                        <mat-icon>inbox</mat-icon>
                        <p>No consumption data available</p>
                    </div>
                </div>

                <div class="report-pagination-bar">
                    <mat-paginator #consumptionPaginator [pageSizeOptions]="[10, 25, 50, 100]"
                        style="display: none;"></mat-paginator>
                    <div class="custom-pagination-container">
                        <div class="pagination-info">
                            <span class="range-label">{{ getCustomRangeLabel(consumptionPaginator) }}</span>
                            <span class="rows-per-page-label">Rows per page:</span>
                            <div class="custom-select-wrapper">
                                <select [value]="consumptionPaginator?.pageSize"
                                    (change)="onCustomPageSizeChange(consumptionPaginator, $any($event.target).value)"
                                    class="custom-page-select">
                                    <option *ngFor="let size of [10, 25, 50, 100]" [value]="size">{{ size }}</option>
                                </select>
                            </div>
                        </div>
                        <div class="pagination-actions">
                            <button class="paginator-btn prev-btn" [disabled]="!hasPreviousPage(consumptionPaginator)"
                                (click)="goToPreviousPage(consumptionPaginator)">
                                <i class="bi bi-chevron-left"></i> Previous
                            </button>
                            <div class="page-numbers-container">
                                <button *ngFor="let page of getPageNumbers(consumptionPaginator)"
                                    class="page-number-btn" [class.active]="page === consumptionPaginator?.pageIndex"
                                    (click)="goToPage(consumptionPaginator, page)">
                                    {{ page + 1 }}
                                </button>
                            </div>
                            <button class="paginator-btn next-btn" [disabled]="!hasNextPage(consumptionPaginator)"
                                (click)="goToNextPage(consumptionPaginator)">
                                Next <i class="bi bi-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>


            </mat-card-content>
        </mat-card>
    </div>
</div>