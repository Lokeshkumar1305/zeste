<div class="staff-onboarding-page">
    <div class="staff-onboarding-container">
        <!-- Page Header -->
        <div class="page-header">
            <div class="header-left">
                <button class="btn-back" (click)="goBack()">
                    <i class="bi bi-arrow-left"></i>
                </button>
                <div class="header-title">
                    <h1>{{ isEditMode ? 'Edit Staff' : 'Staff Onboarding' }}</h1>
                    <p>{{ isEditMode ? 'Update staff information' : 'Add new staff member to your hostel' }}</p>
                </div>
            </div>
            <div class="header-right">
                <span class="employee-id-badge" *ngIf="staffForm.get('employeeId')?.value">
                    <i class="bi bi-person-badge me-1"></i>
                    {{ staffForm.get('employeeId')?.value }}
                </span>
            </div>
        </div>

        <!-- Loading State -->
        <div class="loading-container" *ngIf="isLoading">
            <div class="spinner"></div>
            <p>Loading staff details...</p>
        </div>

        <!-- Main Content -->
        <div class="main-content" *ngIf="!isLoading">
            <!-- Step Progress -->
            <div class="step-progress-container">
                <div class="step-progress">
                    <ng-container *ngFor="let step of steps; let i = index">
                        <div class="step-item" [class.completed]="i < currentStep" [class.active]="i === currentStep"
                            (click)="goToStep(i)">
                            <div class="step-circle">
                                <i *ngIf="i < currentStep" class="bi bi-check"></i>
                                <span *ngIf="i >= currentStep">{{ i + 1 }}</span>
                            </div>
                            <span class="step-label">{{ step.label }}</span>
                        </div>
                        <div *ngIf="i < steps.length - 1" class="step-line" [class.completed]="i < currentStep"></div>
                    </ng-container>
                </div>
            </div>

            <!-- Form Content -->
            <div class="form-content">
                <form [formGroup]="staffForm">
                    <!-- Step 1: Personal Information -->
                    <div class="step-panel" *ngIf="currentStep === 0">
                        <div class="panel-header">
                            <i class="bi bi-person"></i>
                            <h2>Personal Information</h2>
                        </div>

                        <div class="panel-body">
                            <!-- Profile Photo -->
                            <div class="profile-photo-wrapper">
                                <div class="profile-photo" [class.has-photo]="profilePhotoPreview">
                                    <img *ngIf="profilePhotoPreview" [src]="profilePhotoPreview" alt="Profile" />
                                    <i *ngIf="!profilePhotoPreview" class="bi bi-person"></i>
                                </div>
                                <div class="photo-actions">
                                    <input type="file" #photoInput hidden accept="image/jpeg,image/png"
                                        (change)="onProfilePhotoSelect($event)" />
                                    <button type="button" class="btn btn-sm btn-outline-secondary"
                                        (click)="photoInput.click()">
                                        <i class="bi bi-upload me-1"></i> Upload Photo
                                    </button>
                                    <button *ngIf="profilePhotoPreview" type="button"
                                        class="btn btn-sm btn-outline-danger" (click)="removeProfilePhoto()">
                                        <i class="bi bi-trash me-1"></i> Remove
                                    </button>
                                    <small class="text-muted">JPG or PNG, max 2MB</small>
                                </div>
                            </div>

                            <div class="form-grid">
                                <!-- Employee ID -->
                                <div class="form-group">
                                    <label>Employee ID</label>
                                    <mat-form-field appearance="outline" class="w-100">
                                        <input matInput formControlName="employeeId" />
                                        <mat-icon matSuffix>badge</mat-icon>
                                    </mat-form-field>
                                </div>

                                <!-- First Name -->
                                <div class="form-group">
                                    <label class="required">First Name</label>
                                    <mat-form-field appearance="outline" class="w-100">
                                        <input matInput formControlName="firstName" placeholder="Enter first name" />
                                        <mat-error *ngIf="hasError('firstName', 'required')">
                                            First name is required
                                        </mat-error>
                                        <mat-error *ngIf="hasError('firstName', 'minlength')">
                                            Minimum 2 characters
                                        </mat-error>
                                    </mat-form-field>
                                </div>

                                <!-- Last Name -->
                                <div class="form-group">
                                    <label class="required">Last Name</label>
                                    <mat-form-field appearance="outline" class="w-100">
                                        <input matInput formControlName="lastName" placeholder="Enter last name" />
                                        <mat-error *ngIf="hasError('lastName', 'required')">
                                            Last name is required
                                        </mat-error>
                                    </mat-form-field>
                                </div>

                                <!-- Email -->
                                <div class="form-group">
                                    <label class="required">Email Address</label>
                                    <mat-form-field appearance="outline" class="w-100">
                                        <input matInput formControlName="email" placeholder="example@email.com"
                                            type="email" />
                                        <mat-icon matSuffix>email</mat-icon>
                                        <mat-error *ngIf="hasError('email', 'required')">Email is required</mat-error>
                                        <mat-error *ngIf="hasError('email', 'email')">Enter valid email</mat-error>
                                    </mat-form-field>
                                </div>

                                <!-- Phone -->
                                <div class="form-group">
                                    <label class="required">Phone Number</label>
                                    <mat-form-field appearance="outline" class="w-100">
                                        <span matPrefix class="country-code">+91 </span>
                                        <input matInput formControlName="phone" placeholder="9876543210"
                                            maxlength="10" />
                                        <mat-error *ngIf="hasError('phone', 'required')">Phone is required</mat-error>
                                        <mat-error *ngIf="hasError('phone', 'pattern')">
                                            Enter valid 10-digit number
                                        </mat-error>
                                    </mat-form-field>
                                </div>

                                <!-- Alternate Phone -->
                                <div class="form-group">
                                    <label>Alternate Phone</label>
                                    <mat-form-field appearance="outline" class="w-100">
                                        <span matPrefix class="country-code">+91 </span>
                                        <input matInput formControlName="alternatePhone" placeholder="9876543210"
                                            maxlength="10" />
                                        <mat-error *ngIf="hasError('alternatePhone', 'pattern')">
                                            Enter valid number
                                        </mat-error>
                                    </mat-form-field>
                                </div>

                                <!-- Date of Birth -->
                                <div class="form-group">
                                    <label class="required">Date of Birth</label>
                                    <mat-form-field appearance="outline" class="w-100">
                                        <input matInput [matDatepicker]="dobPicker" formControlName="dateOfBirth"
                                            placeholder="Select date" />
                                        <mat-datepicker-toggle matSuffix [for]="dobPicker"></mat-datepicker-toggle>
                                        <mat-datepicker #dobPicker></mat-datepicker>
                                        <mat-hint *ngIf="calculateAge() !== null">
                                            Age: {{ calculateAge() }} years
                                        </mat-hint>
                                        <mat-error *ngIf="hasError('dateOfBirth', 'required')">
                                            Date of birth is required
                                        </mat-error>
                                    </mat-form-field>
                                </div>

                                <!-- Gender -->
                                <div class="form-group">
                                    <label class="required">Gender</label>
                                    <mat-form-field appearance="outline" class="w-100">
                                        <mat-select formControlName="gender" placeholder="Select gender">
                                            <mat-option *ngFor="let g of genders" [value]="g">{{ g }}</mat-option>
                                        </mat-select>
                                        <mat-error *ngIf="hasError('gender', 'required')">Gender is required</mat-error>
                                    </mat-form-field>
                                </div>

                                <!-- Marital Status -->
                                <div class="form-group">
                                    <label>Marital Status</label>
                                    <mat-form-field appearance="outline" class="w-100">
                                        <mat-select formControlName="maritalStatus" placeholder="Select status">
                                            <mat-option *ngFor="let s of maritalStatuses" [value]="s">{{ s
                                                }}</mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </div>

                                <!-- Blood Group -->
                                <div class="form-group">
                                    <label>Blood Group</label>
                                    <mat-form-field appearance="outline" class="w-100">
                                        <mat-select formControlName="bloodGroup" placeholder="Select blood group">
                                            <mat-option *ngFor="let bg of bloodGroups" [value]="bg">{{ bg
                                                }}</mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Address Information -->
                    <div class="step-panel" *ngIf="currentStep === 1">
                        <div class="panel-header">
                            <i class="bi bi-geo-alt"></i>
                            <h2>Address Information</h2>
                        </div>

                        <div class="panel-body">
                            <!-- Current Address -->
                            <div class="address-section">
                                <h3 class="section-subtitle">
                                    <i class="bi bi-house"></i> Current Address
                                </h3>

                                <div class="form-grid" formGroupName="currentAddress">
                                    <div class="form-group full-width">
                                        <label class="required">Street Address</label>
                                        <mat-form-field appearance="outline" class="w-100">
                                            <textarea matInput formControlName="street"
                                                placeholder="Enter street address" rows="2"></textarea>
                                            <mat-error>Street address is required</mat-error>
                                        </mat-form-field>
                                    </div>

                                    <div class="form-group">
                                        <label class="required">City</label>
                                        <mat-form-field appearance="outline" class="w-100">
                                            <input matInput formControlName="city" placeholder="Enter city" />
                                            <mat-error>City is required</mat-error>
                                        </mat-form-field>
                                    </div>

                                    <div class="form-group">
                                        <label class="required">State</label>
                                        <mat-form-field appearance="outline" class="w-100">
                                            <input matInput formControlName="state" placeholder="Enter state" />
                                            <mat-error>State is required</mat-error>
                                        </mat-form-field>
                                    </div>

                                    <div class="form-group">
                                        <label class="required">Pincode</label>
                                        <mat-form-field appearance="outline" class="w-100">
                                            <input matInput formControlName="pincode" placeholder="Enter pincode"
                                                maxlength="6" />
                                            <mat-error>Enter valid 6-digit pincode</mat-error>
                                        </mat-form-field>
                                    </div>

                                    <div class="form-group">
                                        <label>Country</label>
                                        <mat-form-field appearance="outline" class="w-100">
                                            <input matInput formControlName="country" />
                                        </mat-form-field>
                                    </div>
                                </div>
                            </div>

                            <!-- Same Address Checkbox -->
                            <div class="same-address-check">
                                <mat-checkbox formControlName="sameAsCurrentAddress" color="primary">
                                    Permanent address is same as current address
                                </mat-checkbox>
                            </div>

                            <!-- Permanent Address -->
                            <div class="address-section">
                                <h3 class="section-subtitle">
                                    <i class="bi bi-house-door"></i> Permanent Address
                                </h3>

                                <div class="form-grid" formGroupName="permanentAddress">
                                    <div class="form-group full-width">
                                        <label>Street Address</label>
                                        <mat-form-field appearance="outline" class="w-100">
                                            <textarea matInput formControlName="street"
                                                placeholder="Enter street address" rows="2"></textarea>
                                        </mat-form-field>
                                    </div>

                                    <div class="form-group">
                                        <label>City</label>
                                        <mat-form-field appearance="outline" class="w-100">
                                            <input matInput formControlName="city" placeholder="Enter city" />
                                        </mat-form-field>
                                    </div>

                                    <div class="form-group">
                                        <label>State</label>
                                        <mat-form-field appearance="outline" class="w-100">
                                            <input matInput formControlName="state" placeholder="Enter state" />
                                        </mat-form-field>
                                    </div>

                                    <div class="form-group">
                                        <label>Pincode</label>
                                        <mat-form-field appearance="outline" class="w-100">
                                            <input matInput formControlName="pincode" placeholder="Enter pincode"
                                                maxlength="6" />
                                        </mat-form-field>
                                    </div>

                                    <div class="form-group">
                                        <label>Country</label>
                                        <mat-form-field appearance="outline" class="w-100">
                                            <input matInput formControlName="country" />
                                        </mat-form-field>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Employment Details -->
                    <div class="step-panel" *ngIf="currentStep === 2">
                        <div class="panel-header">
                            <i class="bi bi-briefcase"></i>
                            <h2>Employment Details</h2>
                        </div>

                        <div class="panel-body">
                            <div class="form-grid">
                                <!-- Department -->
                                <div class="form-group">
                                    <label class="required">Department</label>
                                    <mat-form-field appearance="outline" class="w-100">
                                        <mat-select formControlName="department" placeholder="Select department">
                                            <mat-option *ngFor="let d of departments" [value]="d">{{ d }}</mat-option>
                                        </mat-select>
                                        <mat-error>Department is required</mat-error>
                                    </mat-form-field>
                                </div>

                                <!-- Designation -->
                                <div class="form-group">
                                    <label class="required">Designation</label>
                                    <mat-form-field appearance="outline" class="w-100">
                                        <mat-select formControlName="designation" placeholder="Select designation">
                                            <mat-option *ngFor="let d of designations" [value]="d">{{ d }}</mat-option>
                                        </mat-select>
                                        <mat-error>Designation is required</mat-error>
                                    </mat-form-field>
                                </div>

                                <!-- Role -->
                                <div class="form-group">
                                    <label class="required">System Role</label>
                                    <mat-form-field appearance="outline" class="w-100">
                                        <mat-select formControlName="role" placeholder="Select role">
                                            <mat-option *ngFor="let r of roles" [value]="r">{{ r }}</mat-option>
                                        </mat-select>
                                        <mat-hint>Access level in the system</mat-hint>
                                        <mat-error>Role is required</mat-error>
                                    </mat-form-field>
                                </div>

                                <!-- Employment Type -->
                                <div class="form-group">
                                    <label class="required">Employment Type</label>
                                    <mat-form-field appearance="outline" class="w-100">
                                        <mat-select formControlName="employmentType" placeholder="Select type">
                                            <mat-option *ngFor="let t of employmentTypes" [value]="t">{{ t
                                                }}</mat-option>
                                        </mat-select>
                                        <mat-error>Employment type is required</mat-error>
                                    </mat-form-field>
                                </div>

                                <!-- Joining Date -->
                                <div class="form-group">
                                    <label class="required">Joining Date</label>
                                    <mat-form-field appearance="outline" class="w-100">
                                        <input matInput [matDatepicker]="joiningPicker" formControlName="joiningDate"
                                            placeholder="Select date" />
                                        <mat-datepicker-toggle matSuffix [for]="joiningPicker"></mat-datepicker-toggle>
                                        <mat-datepicker #joiningPicker></mat-datepicker>
                                        <mat-error>Joining date is required</mat-error>
                                    </mat-form-field>
                                </div>

                                <!-- Reporting To -->
                                <div class="form-group">
                                    <label>Reporting To</label>
                                    <mat-form-field appearance="outline" class="w-100">
                                        <mat-select formControlName="reportingTo" placeholder="Select manager">
                                            <mat-option value="">None</mat-option>
                                            <mat-option *ngFor="let m of managers" [value]="m.id">
                                                {{ m.name }} - {{ m.designation }}
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </div>

                                <!-- Assigned Shift -->
                                <div class="form-group">
                                    <label>Assigned Shift</label>
                                    <mat-form-field appearance="outline" class="w-100">
                                        <mat-select formControlName="assignedShift" placeholder="Select shift">
                                            <mat-option *ngFor="let s of shifts" [value]="s.name">
                                                {{ s.name }} ({{ s.time }})
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </div>

                                <!-- Assigned Floors -->
                                <div class="form-group">
                                    <label>Assigned Floors</label>
                                    <mat-form-field appearance="outline" class="w-100">
                                        <mat-select formControlName="assignedFloors" multiple
                                            placeholder="Select floors">
                                            <mat-option *ngFor="let f of floors" [value]="f">{{ f }}</mat-option>
                                        </mat-select>
                                        <mat-hint>Select multiple if applicable</mat-hint>
                                    </mat-form-field>
                                </div>

                                <!-- Status -->
                                <div class="form-group">
                                    <label class="required">Status</label>
                                    <mat-form-field appearance="outline" class="w-100">
                                        <mat-select formControlName="status" placeholder="Select status">
                                            <mat-option *ngFor="let s of statuses" [value]="s">
                                                <span class="status-dot"
                                                    [class]="'status-' + s.toLowerCase().replace(' ', '-')"></span>
                                                {{ s }}
                                            </mat-option>
                                        </mat-select>
                                        <mat-error>Status is required</mat-error>
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 4: Salary & Bank Details -->
                    <div class="step-panel" *ngIf="currentStep === 3">
                        <div class="panel-header">
                            <i class="bi bi-wallet2"></i>
                            <h2>Salary &amp; Bank Details</h2>
                        </div>

                        <div class="panel-body">
                            <!-- Salary Section -->
                            <div class="salary-section">
                                <h3 class="section-subtitle">
                                    <i class="bi bi-cash-stack"></i> Salary Information
                                </h3>

                                <div class="form-grid">
                                    <!-- Basic Salary -->
                                    <div class="form-group">
                                        <label class="required">Basic Salary</label>
                                        <mat-form-field appearance="outline" class="w-100">
                                            <span matPrefix class="currency-prefix">₹ </span>
                                            <input matInput type="number" formControlName="basicSalary"
                                                placeholder="Enter basic salary" />
                                            <mat-error>Basic salary is required</mat-error>
                                        </mat-form-field>
                                    </div>

                                    <!-- Allowances -->
                                    <div class="form-group">
                                        <label>Allowances</label>
                                        <mat-form-field appearance="outline" class="w-100">
                                            <span matPrefix class="currency-prefix">₹ </span>
                                            <input matInput type="number" formControlName="allowances"
                                                placeholder="HRA, DA, etc." />
                                        </mat-form-field>
                                    </div>

                                    <!-- Deductions -->
                                    <div class="form-group">
                                        <label>Deductions</label>
                                        <mat-form-field appearance="outline" class="w-100">
                                            <span matPrefix class="currency-prefix">₹ </span>
                                            <input matInput type="number" formControlName="deductions"
                                                placeholder="PF, ESI, etc." />
                                        </mat-form-field>
                                    </div>

                                    <!-- Net Salary -->
                                    <div class="form-group">
                                        <label>Net Salary</label>
                                        <mat-form-field appearance="outline" class="w-100">
                                            <span matPrefix class="currency-prefix">₹ </span>
                                            <input matInput formControlName="netSalary" />
                                            <mat-hint>Auto-calculated</mat-hint>
                                        </mat-form-field>
                                    </div>

                                    <!-- Payment Frequency -->
                                    <div class="form-group">
                                        <label>Payment Frequency</label>
                                        <mat-form-field appearance="outline" class="w-100">
                                            <mat-select formControlName="paymentFrequency"
                                                placeholder="Select frequency">
                                                <mat-option *ngFor="let f of paymentFrequencies" [value]="f">
                                                    {{ f }}
                                                </mat-option>
                                            </mat-select>
                                        </mat-form-field>
                                    </div>
                                </div>

                                <!-- Salary Summary -->
                                <div class="salary-summary" *ngIf="staffForm.get('basicSalary')?.value">
                                    <div class="summary-header">Salary Breakdown</div>
                                    <div class="summary-row">
                                        <span>Basic Salary</span>
                                        <span>{{ formatCurrency(staffForm.get('basicSalary')?.value || 0) }}</span>
                                    </div>
                                    <div class="summary-row add">
                                        <span>(+) Allowances</span>
                                        <span>{{ formatCurrency(staffForm.get('allowances')?.value || 0) }}</span>
                                    </div>
                                    <div class="summary-row subtract">
                                        <span>(-) Deductions</span>
                                        <span>{{ formatCurrency(staffForm.get('deductions')?.value || 0) }}</span>
                                    </div>
                                    <div class="summary-row total">
                                        <span>Net Salary</span>
                                        <span>{{ formatCurrency(staffForm.get('netSalary')?.value || 0) }}</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Bank Details Section -->
                            <div class="bank-section">
                                <h3 class="section-subtitle">
                                    <i class="bi bi-bank"></i> Bank Details
                                </h3>

                                <div class="form-grid" formGroupName="bankDetails">
                                    <!-- Account Holder Name -->
                                    <div class="form-group">
                                        <label>Account Holder Name</label>
                                        <mat-form-field appearance="outline" class="w-100">
                                            <input matInput formControlName="accountHolderName"
                                                placeholder="As per bank records" />
                                        </mat-form-field>
                                    </div>

                                    <!-- Account Number -->
                                    <div class="form-group">
                                        <label>Account Number</label>
                                        <mat-form-field appearance="outline" class="w-100">
                                            <input matInput formControlName="accountNumber"
                                                placeholder="Enter account number" />
                                            <mat-error>Enter valid account number</mat-error>
                                        </mat-form-field>
                                    </div>

                                    <!-- Bank Name -->
                                    <div class="form-group">
                                        <label>Bank Name</label>
                                        <mat-form-field appearance="outline" class="w-100">
                                            <input matInput formControlName="bankName" placeholder="Enter bank name" />
                                        </mat-form-field>
                                    </div>

                                    <!-- IFSC Code -->
                                    <div class="form-group">
                                        <label>IFSC Code</label>
                                        <mat-form-field appearance="outline" class="w-100">
                                            <input matInput formControlName="ifscCode" placeholder="e.g., SBIN0001234"
                                                style="text-transform: uppercase;" />
                                            <mat-error>Enter valid IFSC code</mat-error>
                                        </mat-form-field>
                                    </div>

                                    <!-- Branch Name -->
                                    <div class="form-group">
                                        <label>Branch Name</label>
                                        <mat-form-field appearance="outline" class="w-100">
                                            <input matInput formControlName="branchName"
                                                placeholder="Enter branch name" />
                                        </mat-form-field>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 5: Documents -->
                    <div class="step-panel" *ngIf="currentStep === 4">
                        <div class="panel-header">
                            <i class="bi bi-file-earmark-text"></i>
                            <h2>Documents</h2>
                            <button type="button" class="btn btn-sm btn-outline-primary ms-auto"
                                (click)="addDocument()">
                                <i class="bi bi-plus me-1"></i> Add Document
                            </button>
                        </div>

                        <div class="panel-body">
                            <!-- Empty State -->
                            <div class="empty-state" *ngIf="documents.length === 0">
                                <i class="bi bi-file-earmark-plus"></i>
                                <p>No documents added yet</p>
                                <button type="button" class="btn btn-primary btn-sm" (click)="addDocument()">
                                    <i class="bi bi-plus me-1"></i> Add First Document
                                </button>
                            </div>

                            <!-- Document List -->
                            <div formArrayName="documents">
                                <div *ngFor="let doc of documents.controls; let i = index" [formGroupName]="i"
                                    class="document-card">
                                    <div class="document-row">
                                        <div class="form-group">
                                            <label class="required">Document Type</label>
                                            <mat-form-field appearance="outline" class="w-100">
                                                <mat-select formControlName="type" placeholder="Select type">
                                                    <mat-option *ngFor="let t of documentTypes" [value]="t">
                                                        {{ t }}
                                                    </mat-option>
                                                </mat-select>
                                                <mat-error>Required</mat-error>
                                            </mat-form-field>
                                        </div>

                                        <div class="form-group">
                                            <label class="required">Document Number</label>
                                            <mat-form-field appearance="outline" class="w-100">
                                                <input matInput formControlName="number" placeholder="Enter number" />
                                                <mat-error>Required</mat-error>
                                            </mat-form-field>
                                        </div>

                                        <div class="form-group">
                                            <label>Upload File</label>
                                            <div class="file-input-wrapper">
                                                <input type="file" [id]="'doc-' + i" hidden
                                                    accept=".pdf,.jpg,.jpeg,.png"
                                                    (change)="onDocumentFileSelect($event, i)" />
                                                <label [for]="'doc-' + i" class="file-input-label">
                                                    <i class="bi bi-cloud-upload"></i>
                                                    <span>{{ doc.get('fileName')?.value || 'Choose file' }}</span>
                                                </label>
                                            </div>
                                        </div>

                                        <div class="form-group checkbox-group">
                                            <mat-checkbox formControlName="verified" color="primary">
                                                Verified
                                            </mat-checkbox>
                                        </div>

                                        <button type="button" class="btn-remove" (click)="removeDocument(i)">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Document Info -->
                            <div class="info-box" *ngIf="documents.length > 0">
                                <i class="bi bi-info-circle"></i>
                                <div>
                                    <p>Accepted formats: PDF, JPG, PNG (Max 5MB each)</p>
                                    <p>Recommended: Aadhar Card, PAN Card, Address Proof</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 6: Schedule & Others -->
                    <div class="step-panel" *ngIf="currentStep === 5">
                        <div class="panel-header">
                            <i class="bi bi-calendar-check"></i>
                            <h2>Schedule &amp; Additional Info</h2>
                        </div>

                        <div class="panel-body">
                            <!-- Emergency Contacts -->
                            <div class="section-block">
                                <div class="section-header">
                                    <h3 class="section-subtitle">
                                        <i class="bi bi-telephone"></i> Emergency Contacts
                                    </h3>
                                    <button type="button" class="btn btn-sm btn-outline-primary"
                                        (click)="addEmergencyContact()" [disabled]="emergencyContacts.length >= 3">
                                        <i class="bi bi-plus me-1"></i> Add Contact
                                    </button>
                                </div>

                                <div formArrayName="emergencyContacts">
                                    <div *ngFor="let contact of emergencyContacts.controls; let i = index"
                                        [formGroupName]="i" class="contact-card">
                                        <div class="contact-header">
                                            <span class="contact-number">Contact {{ i + 1 }}</span>
                                            <button *ngIf="emergencyContacts.length > 1" type="button"
                                                class="btn-remove-sm" (click)="removeEmergencyContact(i)">
                                                <i class="bi bi-x"></i>
                                            </button>
                                        </div>
                                        <div class="contact-row">
                                            <div class="form-group">
                                                <label class="required">Name</label>
                                                <mat-form-field appearance="outline" class="w-100">
                                                    <input matInput formControlName="name" placeholder="Contact name" />
                                                    <mat-error>Required</mat-error>
                                                </mat-form-field>
                                            </div>

                                            <div class="form-group">
                                                <label class="required">Relationship</label>
                                                <mat-form-field appearance="outline" class="w-100">
                                                    <mat-select formControlName="relationship" placeholder="Select">
                                                        <mat-option *ngFor="let r of relationships" [value]="r">
                                                            {{ r }}
                                                        </mat-option>
                                                    </mat-select>
                                                    <mat-error>Required</mat-error>
                                                </mat-form-field>
                                            </div>

                                            <div class="form-group">
                                                <label class="required">Phone Number</label>
                                                <mat-form-field appearance="outline" class="w-100">
                                                    <span matPrefix class="country-code">+91 </span>
                                                    <input matInput formControlName="phone" placeholder="9876543210"
                                                        maxlength="10" />
                                                    <mat-error>Valid phone required</mat-error>
                                                </mat-form-field>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Work Schedule -->
                            <div class="section-block">
                                <h3 class="section-subtitle">
                                    <i class="bi bi-clock"></i> Work Schedule
                                </h3>

                                <div class="schedule-grid" formArrayName="workSchedule">
                                    <div *ngFor="let day of workSchedule.controls; let i = index" [formGroupName]="i"
                                        class="schedule-item" [class.day-off]="!day.get('isWorking')?.value">
                                        <div class="day-toggle">
                                            <mat-checkbox formControlName="isWorking" color="primary">
                                                {{ day.get('day')?.value }}
                                            </mat-checkbox>
                                        </div>

                                        <div class="time-range" *ngIf="day.get('isWorking')?.value">
                                            <mat-form-field appearance="outline" class="time-input">
                                                <input matInput type="time" formControlName="startTime" />
                                            </mat-form-field>
                                            <span class="time-separator">to</span>
                                            <mat-form-field appearance="outline" class="time-input">
                                                <input matInput type="time" formControlName="endTime" />
                                            </mat-form-field>
                                        </div>

                                        <span class="off-label" *ngIf="!day.get('isWorking')?.value">
                                            Day Off
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <!-- Skills -->
                            <div class="section-block">
                                <h3 class="section-subtitle">
                                    <i class="bi bi-tools"></i> Skills
                                </h3>
                                <div class="chip-list">
                                    <div *ngFor="let skill of skillOptions" class="chip"
                                        [class.selected]="isSkillSelected(skill)" (click)="toggleSkill(skill)">
                                        {{ skill }}
                                    </div>
                                </div>
                            </div>

                            <!-- Languages -->
                            <div class="section-block">
                                <h3 class="section-subtitle">
                                    <i class="bi bi-translate"></i> Languages Known
                                </h3>
                                <div class="chip-list">
                                    <div *ngFor="let lang of languageOptions" class="chip"
                                        [class.selected]="isLanguageSelected(lang)" (click)="toggleLanguage(lang)">
                                        {{ lang }}
                                    </div>
                                </div>
                            </div>

                            <!-- Notes -->
                            <div class="section-block">
                                <h3 class="section-subtitle">
                                    <i class="bi bi-sticky"></i> Additional Notes
                                </h3>
                                <mat-form-field appearance="outline" class="w-100">
                                    <textarea matInput formControlName="notes" rows="4"
                                        placeholder="Any additional information..."></textarea>
                                    <mat-hint align="end">
                                        {{ staffForm.get('notes')?.value?.length || 0 }}/500
                                    </mat-hint>
                                </mat-form-field>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Footer Actions -->
            <div class="form-footer">
                <div class="footer-left">
                    <button type="button" class="btn btn-outline-secondary" (click)="onSaveAsDraft()"
                        *ngIf="!isEditMode && currentStep > 0" [disabled]="isSaving">
                        <i class="bi bi-save me-1"></i> Save as Draft
                    </button>
                </div>
                <div class="footer-right">
                    <button type="button" class="btn btn-outline-secondary" (click)="goBack()">
                        Cancel
                    </button>
                    <button *ngIf="currentStep > 0" type="button" class="btn btn-outline-primary"
                        (click)="previousStep()">
                        <i class="bi bi-chevron-left me-1"></i> Previous
                    </button>
                    <button *ngIf="currentStep < steps.length - 1" type="button" class="btn btn-primary"
                        (click)="nextStep()">
                        Next <i class="bi bi-chevron-right ms-1"></i>
                    </button>
                    <button *ngIf="currentStep === steps.length - 1" type="button" class="btn btn-success"
                        (click)="onSave()" [disabled]="isSaving">
                        <span *ngIf="isSaving" class="spinner-border spinner-border-sm me-1"></span>
                        <i *ngIf="!isSaving" class="bi bi-check2 me-1"></i>
                        {{ isEditMode ? 'Update Staff' : 'Complete Onboarding' }}
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>