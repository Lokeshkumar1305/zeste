<div class="modal-slide-in">
  <!-- Header -->
  <div class="modal-header d-flex align-items-center justify-content-between">
    <div>
      <p class="f-18-m mb-0">
        <i class="bi bi-arrow-left-right me-2"></i> Stock Movement
      </p>
      <small class="text-muted">Add stock (IN) or remove stock (OUT)</small>
    </div>
    <button mat-icon-button (click)="onCancel()" class="text-muted">
      <i class="bi bi-x-lg"></i>
    </button>
  </div>

  <!-- Body -->
  <div class="modal-body">
    <!-- Help Box -->
    <div class="help-box mb-4">
      <div class="help-icon">
        <i class="bi bi-lightbulb"></i>
      </div>
      <div class="help-content">
        <strong>What is Stock Movement?</strong>
        <p class="mb-0">
          <strong>Stock IN:</strong> When you buy or receive items (adds to stock)<br>
          <strong>Stock OUT:</strong> When you use or give away items (removes from stock)
        </p>
      </div>
    </div>

    <!-- Type Toggle -->
    <div class="type-toggle mb-4">
      <button type="button" class="toggle-btn in" [class.active]="movement.type === 'IN'"
        (click)="movement.type = 'IN'">
        <i class="bi bi-arrow-down-circle"></i>
        <span>Stock IN</span>
        <small>Add items</small>
      </button>
      <button type="button" class="toggle-btn out" [class.active]="movement.type === 'OUT'"
        (click)="movement.type = 'OUT'">
        <i class="bi bi-arrow-up-circle"></i>
        <span>Stock OUT</span>
        <small>Remove items</small>
      </button>
    </div>

    <form #movementForm="ngForm">
      <div class="row g-3">
        <!-- Select Item -->
        <div class="col-12">
          <mat-label class="required">Select Item</mat-label>
          <mat-form-field appearance="outline" class="w-100 mt-1">
            <mat-select [(ngModel)]="movement.itemId" name="itemId" required (selectionChange)="onItemChange()">
              <mat-option *ngFor="let item of items" [value]="item.id">
                {{ item.name }} <span class="text-muted">(Current: {{ item.currentStock }} {{ item.unitName }})</span>
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Current â†’ New Stock Display -->
        <div class="col-12" *ngIf="selectedItem">
          <div class="current-stock-display">
            <div class="stock-box current">
              <span class="label">Current Stock</span>
              <span class="value">{{ selectedItem.currentStock }} {{ selectedItem.unitName }}</span>
            </div>
            <div class="arrow">
              <i class="bi" [class.bi-arrow-right]="movement.type === 'IN'"
                [class.bi-arrow-left]="movement.type === 'OUT'"></i>
              <span [class.text-success]="movement.type === 'IN'" [class.text-danger]="movement.type === 'OUT'">
                {{ movement.type === 'IN' ? '+' : '-' }}{{ movement.quantity || 0 }}
              </span>
            </div>
            <div class="stock-box new" [class.increased]="movement.type === 'IN'"
              [class.decreased]="movement.type === 'OUT'">
              <span class="label">New Stock</span>
              <span class="value">{{ getNewStock() }} {{ selectedItem.unitName }}</span>
            </div>
          </div>
        </div>

        <!-- Quantity -->
        <div class="col-12 col-md-6">
          <mat-label class="required">Quantity</mat-label>
          <mat-form-field appearance="outline" class="w-100 mt-1">
            <input matInput type="number" [(ngModel)]="movement.quantity" name="quantity" min="1" required />
            <span matSuffix *ngIf="selectedItem">{{ selectedItem.unitName }}</span>
          </mat-form-field>
        </div>

        <!-- Reference -->
        <div class="col-12 col-md-6">
          <mat-label>Reference Number</mat-label>
          <mat-form-field appearance="outline" class="w-100 mt-1">
            <input matInput [(ngModel)]="movement.reference" name="reference" readonly />
          </mat-form-field>
        </div>

        <!-- Reason -->
        <div class="col-12">
          <mat-label class="required">Reason</mat-label>
          <mat-form-field appearance="outline" class="w-100 mt-1">
            <mat-select [(ngModel)]="movement.reason" name="reason" required>
              <mat-option *ngFor="let r of (movement.type === 'IN' ? reasonsIN : reasonsOUT)" [value]="r">
                {{ r }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Performed By & Notes -->
        <div class="col-12 col-md-6">
          <mat-label>Done By</mat-label>
          <mat-form-field appearance="outline" class="w-100 mt-1">
            <input matInput [(ngModel)]="movement.performedBy" name="performedBy" />
          </mat-form-field>
        </div>
        <div class="col-12 col-md-6">
          <mat-label>Notes</mat-label>
          <mat-form-field appearance="outline" class="w-100 mt-1">
            <input matInput [(ngModel)]="movement.notes" name="notes" />
          </mat-form-field>
        </div>
      </div>
    </form>
  </div>

  <!-- Footer -->


  <div class="modal-footer d-flex justify-content-end gap-3">
    <button mat-stroked-button (click)="onCancel()">Cancel</button>
    <button mat-flat-button [color]="movement.type === 'IN' ? 'primary' : 'warn'" (click)="onSave()"
      [disabled]="!movementForm.valid || !movement.itemId">
      <i class="bi me-1" [class.bi-plus-circle]="movement.type === 'IN'"
        [class.bi-dash-circle]="movement.type === 'OUT'"></i>
      {{ movement.type === 'IN' ? 'Add' : 'Remove' }} Stock
    </button>
  </div>

</div>