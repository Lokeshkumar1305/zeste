<div class="mobile-screen menu-page">
    <header class="app-bar">
        <h1 class="app-title">Today's Menu</h1>
        <button class="icon-btn" (click)="refreshMenus()" [disabled]="isLoading">
            <i class="bi bi-arrow-clockwise" [class.spinning]="isLoading"></i>
        </button>
    </header>

    <div class="screen-content">
        <!-- View Mode Tabs -->
        <div class="view-mode-tabs">
            <button class="tab-btn" [class.active]="viewMode === 'today'" (click)="changeViewMode('today')">
                <i class="bi bi-brightness-high"></i> Today
            </button>
            <button class="tab-btn" [class.active]="viewMode === 'week'" (click)="changeViewMode('week')">
                <i class="bi bi-calendar-week"></i> Weekly
            </button>
        </div>

        <!-- Meal Type Filters (Horizontal Scroll) -->
        <div class="meal-filters-scroll" *ngIf="viewMode === 'today'">
            <button *ngFor="let mealType of mealTypes" class="filter-chip"
                [class.active]="selectedMealFilter === mealType" (click)="filterByMealType(mealType)">
                <i class="bi" [ngClass]="getMealIconClass(mealType)"></i>
                <span>{{ mealType === 'all' ? 'All' : mealType }}</span>
            </button>
        </div>

        <!-- Content -->
        <div class="center-content" *ngIf="isLoading">
            <div class="spinner"></div>
        </div>

        <!-- Today's List -->
        <div class="today-menu-list" *ngIf="!isLoading && viewMode === 'today'">
            <div *ngFor="let menu of getFilteredMenus(todayMenus)" class="mobile-menu-card"
                [class.serving]="isMenuServing(menu)">
                <div class="card-header">
                    <div class="meal-info">
                        <div class="meal-icon-box">
                            <i class="bi" [ngClass]="'bi-' + getMealIcon(menu.mealType)"></i>
                        </div>
                        <div class="text">
                            <h3>{{ menu.mealType }}</h3>
                            <span class="time">{{ menu.serveFrom }} - {{ menu.serveTo }}</span>
                        </div>
                    </div>
                    <div class="serving-pill" *ngIf="isMenuServing(menu)">
                        <span class="dot"></span> Serving
                    </div>
                </div>

                <div class="items-horizontal">
                    <div *ngFor="let item of menu.items" class="food-item-mobile">
                        <div class="img-wrapper">
                            <img [src]="item.imageUrl || 'assets/default-food.png'">
                            <span class="veg-non-veg" [class]="item.itemType?.toLowerCase()"></span>
                        </div>
                        <span class="item-name">{{ item.itemName }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Weekly View (Accordion style for mobile) -->
        <div class="weekly-accordion" *ngIf="!isLoading && viewMode === 'week'">
            <div *ngFor="let day of daysOfWeek" class="day-row" [class.today]="day.value === currentDayOfWeek">
                <div class="day-header" (click)="day.expanded = !day.expanded">
                    <span class="day-name">{{ day.label }} <span class="badge"
                            *ngIf="day.value === currentDayOfWeek">Today</span></span>
                    <i class="bi" [class]="day.expanded ? 'bi-chevron-up' : 'bi-chevron-down'"></i>
                </div>
                <div class="day-content" *ngIf="day.expanded">
                    <div *ngFor="let menu of getMenusForDay(day.value)" class="mini-menu-row">
                        <span class="meal">{{ menu.mealType }}</span>
                        <div class="items">
                            <span *ngFor="let item of menu.items; let last = last">{{ item.itemName }}<span
                                    *ngIf="!last">, </span></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>