<div class="modal-slide-in">
    <div class="modal-header d-flex align-items-center justify-content-between">
        <p class="f-18-m mb-0">
            {{ data?.tenant ? 'Edit' : 'Onboard New' }} Tenant
        </p>
        <button mat-icon-button (click)="onCancel()" class="text-muted">
            <i class="bi bi-x-lg"></i>
        </button>
    </div>

    <div class="modal-body">
        <form #tenantForm="ngForm">
            <div class="row g-3">
                <!-- Full Name -->
                <div class="col-12 col-md-6">
                    <mat-label class="required">Full Name</mat-label>
                    <mat-form-field appearance="outline" class="w-100 mt-1">
                        <input matInput [(ngModel)]="tenant.fullName" name="fullName" required placeholder="John Doe" />
                    </mat-form-field>
                </div>

                <!-- Email -->
                <div class="col-12 col-md-6">
                    <mat-label class="required">Email</mat-label>
                    <mat-form-field appearance="outline" class="w-100 mt-1">
                        <input matInput [(ngModel)]="tenant.email" name="email" type="email" required
                            placeholder="john.doe@email.com" />
                    </mat-form-field>
                </div>

                <!-- Phone Number -->
                <div class="col-12 col-md-6">
                    <mat-label class="required">Phone Number</mat-label>
                    <mat-form-field appearance="outline" class="w-100 mt-1">
                        <input matInput [(ngModel)]="tenant.phone" name="phone" required placeholder="+91 9876543210" />
                    </mat-form-field>
                </div>

                <!-- Room Number -->
                <div class="col-12 col-md-6">
                    <mat-label class="required">Room Number</mat-label>
                    <mat-form-field appearance="outline" class="w-100 mt-1">
                        <input matInput [(ngModel)]="tenant.roomNumber" name="roomNumber" required placeholder="101" />
                    </mat-form-field>
                </div>

                <!-- Check-in Date -->
                <div class="col-12 col-md-6">
                    <mat-label class="required">Check-in Date</mat-label>
                    <mat-form-field appearance="outline" class="w-100 mt-1">
                        <input matInput [matDatepicker]="checkinPicker" [(ngModel)]="tenant.checkinDate"
                            name="checkinDate" required />
                        <mat-datepicker-toggle matIconSuffix [for]="checkinPicker"></mat-datepicker-toggle>
                        <mat-datepicker #checkinPicker></mat-datepicker>
                    </mat-form-field>
                </div>

                <!-- Status -->
                <div class="col-12 col-md-6">
                    <mat-label class="required">Status</mat-label>
                    <mat-form-field appearance="outline" class="w-100 mt-1">
                        <mat-select [(ngModel)]="tenant.status" name="status" required>
                            <mat-option value="Active">Active</mat-option>
                            <mat-option value="Inactive">Inactive</mat-option>
                            <mat-option value="Pending">Pending</mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>

                <!-- Monthly Rent -->
                <div class="col-12 col-md-6">
                    <mat-label class="required">Monthly Rent</mat-label>
                    <mat-form-field appearance="outline" class="w-100 mt-1">
                        <span matTextPrefix>₹&nbsp;</span>
                        <input matInput [(ngModel)]="tenant.monthlyRent" name="monthlyRent" type="number" required
                            min="0" placeholder="8000" />
                    </mat-form-field>
                </div>

                <!-- Security Deposit -->
                <div class="col-12 col-md-6">
                    <mat-label class="required">Security Deposit</mat-label>
                    <mat-form-field appearance="outline" class="w-100 mt-1">
                        <span matTextPrefix>₹&nbsp;</span>
                        <input matInput [(ngModel)]="tenant.securityDeposit" name="securityDeposit" type="number"
                            required min="0" placeholder="16000" />
                    </mat-form-field>
                </div>

                <!-- Emergency Contact -->
                <div class="col-12 col-md-6">
                    <mat-label>Emergency Contact</mat-label>
                    <mat-form-field appearance="outline" class="w-100 mt-1">
                        <input matInput [(ngModel)]="tenant.emergencyContact" name="emergencyContact"
                            placeholder="+91 9876543211" />
                    </mat-form-field>
                </div>

                <!-- Occupation -->
                <div class="col-12 col-md-6">
                    <mat-label>Occupation</mat-label>
                    <mat-form-field appearance="outline" class="w-100 mt-1">
                        <input matInput [(ngModel)]="tenant.occupation" name="occupation"
                            placeholder="Software Engineer" />
                    </mat-form-field>
                </div>

                <!-- ID Proof Type -->
                <div class="col-12 col-md-6">
                    <mat-label class="required">ID Proof Type</mat-label>
                    <mat-form-field appearance="outline" class="w-100 mt-1">
                        <mat-select [(ngModel)]="tenant.idProofType" name="idProofType" required
                            (selectionChange)="onIdProofTypeChange()">
                            <mat-option value="">-- Select --</mat-option>
                            <mat-option value="Aadhar Card">Aadhar Card</mat-option>
                            <mat-option value="Passport">Passport</mat-option>
                            <mat-option value="Driving License">Driving License</mat-option>
                            <mat-option value="Voter ID">Voter ID</mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>

                <!-- ID Proof Upload -->
                <div class="col-12" *ngIf="tenant.idProofType">
                    <mat-label class="required d-block mb-1">{{ tenant.idProofType }} Upload</mat-label>
                    <div class="upload-container">
                        <div *ngIf="!tenant.idProofFile; else filePreview">
                            <input #idFileInput type="file" (change)="onIdFileSelected($event)"
                                accept=".pdf,.jpg,.jpeg,.png" style="display: none">
                            <button mat-stroked-button color="primary" (click)="idFileInput.click()">
                                <i class="bi bi-upload me-2"></i> Choose File
                            </button>
                            <small class="text-muted d-block mt-2">PDF, JPG, PNG • Max 5MB</small>
                        </div>

                        <ng-template #filePreview>
                            <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
                                <div class="d-flex align-items-center gap-3">
                                    <i class="bi bi-file-earmark-check text-success fs-4"></i>
                                    <div>
                                        <div class="fw-medium text-truncate" style="max-width: 200px;">
                                            {{ tenant.idProofFile?.name }}
                                        </div>
                                        <small class="text-muted">{{ formatFileSize(tenant.idProofFile?.size) }}</small>
                                    </div>
                                </div>
                                <div class="d-flex gap-2">
                                    <button mat-icon-button color="primary" (click)="downloadFile(tenant.idProofFile)"
                                        title="Download">
                                        <i class="bi bi-download"></i>
                                    </button>
                                    <button mat-icon-button color="warn" (click)="removeIdProof()" title="Remove">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </ng-template>
                    </div>
                </div>

                <!-- Address -->
                <div class="col-12">
                    <mat-label>Address</mat-label>
                    <mat-form-field appearance="outline" class="w-100 mt-1">
                        <textarea matInput rows="3" [(ngModel)]="tenant.address" name="address"
                            placeholder="123 Main Street, City, State"></textarea>
                    </mat-form-field>
                </div>
            </div>
        </form>
    </div>

    <div class="modal-footer d-flex justify-content-end gap-3">
        <button type="button" class="btn btn-outline-secondary btn-sm" (click)="onCancel()">
            Cancel
        </button>
        <button type="button" class="btn btn-primary btn-sm" (click)="onSave()"
            [disabled]="!tenantForm.valid || (tenant.idProofType && !tenant.idProofFile)">
            <i class="bi bi-check2 me-1"></i>
            {{ data?.tenant ? 'Update' : 'Onboard' }} Tenant
        </button>
    </div>
</div>